# 전력 네트워크 시뮬레이터 프로젝트 분석

## 목차

1.  [서론](#1-서론)
    *   [프로젝트 개요 및 목적](#프로젝트-개요-및-목적)
    *   [주요 기능](#주요-기능)
2.  [시스템-아키텍처](#2-시스템-아키텍처)
    *   [전체-모듈-구성도](#전체-모듈-구성도)
    *   [모듈별-역할-요약](#모듈별-역할-요약)
3.  [코어-시뮬레이션-엔진](#3-코어-시뮬레이션-엔진)
    *   [`simulator.py`](#simulatorpy)
    *   [`city.py`](#citypy)
4.  [전력-시스템-모델링](#4-전력-시스템-모델링)
    *   [`modules/power.py`](#modulespowerpy)
    *   [`algorithms.py`](#algorithmspy)
5.  [환경-모델링](#5-환경-모델링)
    *   [`modules/weather.py`](#modulesweatherpy)
    *   [`modules/event.py`](#moduleseventpy)
6.  [경제-모델링](#6-경제-모델)
    *   [`modules/economics.py`](#moduleseconomicspy)
7.  [데이터-관리](#7-데이터-관리)
    *   [`data.py`](#datapy)
    *   [`scenarios.json`](#scenariosjson)
8.  [사용자-인터페이스](#8-사용자-인터페이스)
    *   [Pygame-기반-UI](#pygame-기반-ui)
    *   [Web-기반-UI-Flask](#web-기반-ui-flask)
9.  [시뮬레이션-분석](#9-시뮬레이션-분석)
    *   [`modules/analytics.py`](#modulesanalyticspy)
10. [결론-및-향후-개선-방향](#10-결론-및-향후-개선-방향)

## 1. 서론

### 프로젝트 개요 및 목적

본 프로젝트는 복잡한 전력 네트워크 시스템을 시뮬레이션하고 분석하기 위해 개발된 소프트웨어입니다. 사용자는 다양한 시나리오를 설정하여 전력 생산, 송전, 분배, 소비 과정을 모의실험하고, 날씨 변화, 돌발 이벤트, 경제적 요인 등이 네트워크에 미치는 영향을 관찰할 수 있습니다. 이를 통해 전력망의 안정성, 효율성, 경제성 등을 평가하고 개선 방안을 모색하는 것을 목표로 합니다.

주요 특징으로는 상세한 전력 흐름 계산, 동적인 환경 변화(날씨, 이벤트), 경제 모델 연동, 그리고 두 가지 형태의 사용자 인터페이스(Pygame 및 웹) 제공 등이 있습니다.

### 주요 기능

*   **전력 네트워크 모델링**: 발전소, 소비지(건물 유형별), 송전선 등 네트워크 구성 요소를 상세하게 모델링합니다.
*   **동적 시뮬레이션**: 시간의 흐름에 따라 변화하는 전력 수요와 공급, 날씨, 이벤트 등을 시뮬레이션합니다.
*   **전력 흐름 분석**: Edmonds-Karp 알고리즘을 기반으로 네트워크 내의 전력 흐름을 계산하고, 과부하 및 정전 상황을 분석합니다.
*   **환경 요인 반영**: 기온, 습도, 구름량, 미세먼지 등 날씨 변화가 전력 수요 및 태양광 발전에 미치는 영향을 모델링합니다.
*   **돌발 이벤트 시스템**: 송전선 고장, 발전소 출력 감소, 수요 급증 등 다양한 랜덤 이벤트를 발생시켜 네트워크의 강건성을 시험합니다.
*   **경제 모델 연동**: 에너지 가격 결정, 투자 수익 분석 등 경제적 측면을 시뮬레이션에 통합합니다. (선택적 모듈)
*   **시나리오 기반 실험**: 사용자가 정의한 다양한 시나리오(네트워크 구성, 초기 조건, 이벤트 등)를 로드하여 실험할 수 있습니다.
*   **사용자 인터페이스**:
    *   Pygame 기반의 그래픽 인터페이스를 통해 시뮬레이션 과정을 시각적으로 확인하고 직접 제어할 수 있습니다.
    *   Flask 기반의 웹 인터페이스를 통해 원격으로 시뮬레이션 상태를 모니터링하고 제어할 수 있습니다.
*   **데이터 분석 및 리포팅**: 시뮬레이션 결과를 수집하고, 주요 지표를 분석하여 보고서를 생성하며, LLM을 통한 분석도 지원합니다. (선택적 기능)

## 2. 시스템 아키텍처

### 전체 모듈 구성도

```mermaid
graph TD
    A[main.py] --> B(Simulator);
    B --> C{CityGraph};
    B --> D{PowerSystem};
    B --> E{WeatherSystem};
    B --> F{EventSystem};
    B --> G{EconomicModel};
    B --> H{SimulationAnalytics};

    C --> I[Building];
    C --> J[PowerLine];

    D --> K(algorithms.py);

    M[Pygame UI] --> B;
    M --> L[uis.py];
    M --> N[drawer_base.py];
    M --> O[drawer_ui.py];

    P[Web UI (Flask)] --> B;
    P --> Q[web_interface/app.py];

    B --> R(data.py);
    B --> S(scenarios.json);
```

*   **`main.py`**: 프로그램의 진입점. 인자 파싱, 시나리오 로드, 시뮬레이터 및 UI(Pygame/Web) 초기화 및 실행 담당.
*   **`Simulator` (`simulator.py`)**: 시뮬레이션의 핵심 제어 로직. 시간 관리, 시나리오 관리, 주요 시스템 모듈(도시, 전력, 날씨, 이벤트, 경제, 분석)의 통합 및 업데이트 조정.
*   **`CityGraph`, `Building`, `PowerLine` (`city.py`)**: 전력 네트워크의 물리적 구성 요소(도시, 건물, 송전선)를 모델링. 건물/송전선 추가, 제거, 상태 관리 및 전력 흐름 계산을 위한 그래프 구조 제공.
*   **`PowerSystem` (`modules/power.py`)**: 전력 시스템의 동적인 측면을 관리하고 계산하는 역할을 합니다.
*   **`WeatherSystem` (`modules/weather.py`)**: 날씨 및 환경 변화(기온, 습도, 구름, 미세먼지 등)를 모델링하고, 이것이 전력 수요 및 태양광 발전에 미치는 영향 계산.
*   **`EventSystem` (`modules/event.py`)**: 송전선 고장, 발전소 출력 변동 등 다양한 랜덤 이벤트를 발생시켜 시뮬레이션에 동적인 변화를 추가.
*   **`EconomicModel` (`modules/economics.py`)**: (선택적 모듈) 에너지 가격, 투자 수익 분석 등 경제적 측면을 모델링.
*   **`SimulationAnalytics` (`modules/analytics.py`)**: 시뮬레이션 데이터 수집, 주요 지표 분석, 보고서 생성 및 LLM을 통한 분석 기능 제공.
*   **`algorithms.py`**: 전력 흐름 계산(Edmonds-Karp), 수요/공급 요인 계산 등 핵심 알고리즘 구현.
*   **`data.py`**: 지역별 날씨 데이터, 건물 유형별 특성 계수 등 정적 데이터 저장.
*   **`scenarios.json`**: 시뮬레이션 시나리오(네트워크 구성, 초기 조건 등)를 JSON 형식으로 정의.
*   **Pygame UI** (`uis.py`, `drawer_base.py`, `drawer_ui.py`): Pygame을 사용하여 시뮬레이션을 시각화하고 사용자와 상호작용하는 인터페이스.
*   **Web UI** (`web_interface/app.py`): Flask 및 SocketIO를 사용하여 웹 브라우저를 통해 시뮬레이션 상태를 원격으로 모니터링하고 제어하는 인터페이스.

### 모듈별 역할 요약

*   **데이터 계층**:
    *   `data.py`: 시스템 전반에서 사용되는 정적 데이터(기후 정보, 건물 특성 등)를 제공합니다.
    *   `scenarios.json`: 사용자가 다양한 실험 환경을 구성할 수 있도록 시나리오 정보를 저장합니다.
*   **코어 로직 계층**:
    *   `simulator.py`: 전체 시뮬레이션의 생명주기를 관리하고, 각 하위 시스템 모듈의 조화로운 작동을 조율합니다.
    *   `city.py`: 전력 네트워크의 물리적 토폴로지와 구성 요소의 상태를 관리합니다.
    *   `algorithms.py`: 복잡한 계산(최대 유량 등)을 수행하여 시뮬레이션의 핵심 기능을 지원합니다.
*   **시스템 모델링 계층**:
    *   `modules/power.py`: 전력의 생산, 흐름, 소비 및 정전과 같은 전력 시스템의 동적 측면을 모델링합니다.
    *   `modules/weather.py`: 외부 환경 요인이 시스템에 미치는 영향을 시뮬레이션합니다.
    *   `modules/event.py`: 예기치 않은 사건 발생을 통해 시스템의 강건성을 테스트합니다.
    *   `modules/economics.py`: 전력 시장의 경제적 상호작용을 모델링하여 현실성을 더합니다.
*   **인터페이스 및 분석 계층**:
    *   `uis.py`, `drawer_base.py`, `drawer_ui.py`: Pygame을 통해 사용자에게 시각적 피드백과 제어 수단을 제공합니다.
    *   `web_interface/app.py`: 웹 기반으로 시뮬레이션에 접근하고 제어할 수 있는 현대적인 인터페이스를 제공합니다.
    *   `modules/analytics.py`: 시뮬레이션 결과를 수집, 분석하고 인사이트를 도출하여 사용자에게 제공합니다.

## 3. 코어 시뮬레이션 엔진

코어 시뮬레이션 엔진은 전력 네트워크 시뮬레이션의 심장부로, 시뮬레이션의 전체 흐름을 제어하고 핵심 데이터 구조를 관리합니다. 주요 구성 요소는 `Simulator` 클래스와 도시 및 네트워크 요소를 정의하는 `CityGraph`, `Building`, `PowerLine` 클래스입니다.

### `simulator.py` (`Simulator` 클래스)

`Simulator` 클래스는 시뮬레이션의 전체적인 생명주기, 상태 관리, 모듈 간의 상호작용을 총괄합니다. 주요 기능은 다음과 같습니다.

*   **초기화 (`__init__`)**: 시뮬레이션에 필요한 기본 상태 변수들을 초기화합니다. 여기에는 도시 그래프(`CityGraph`), 시나리오 패턴, 예산, 자금, 이벤트 카운트, 시뮬레이션 시간, 게임 속도 등이 포함됩니다. 또한, 날씨 시스템과 관련된 변수들(현재 날씨, 지속 시간, 태양광 효율, 기온, 습도, 구름량, 미세먼지 수준)도 초기 설정됩니다.
*   **시나리오 관리**:
    *   `set_scenarios(scenarios)`: 외부(일반적으로 `main.py`에서 `scenarios.json` 파일을 읽어온 결과)에서 시나리오 목록을 받아 내부 변수에 저장합니다.
    *   `load_scenario(scenario)`: 특정 시나리오를 로드하여 시뮬레이션 환경을 구성합니다. 도시 그래프, 패턴, 예산, 건물 및 송전선 정보를 시나리오 파일에 정의된 내용으로 재설정합니다. 시나리오 로드 후에는 날씨 정보를 한 번 업데이트하고, 초기 전력 흐름을 계산합니다.
*   **시간 관리 (`update_sim_time`, `gameSpeed`)**: `update_sim_time(dt_ms)` 메서드는 외부에서 전달된 시간 경과(밀리초)와 `gameSpeed` 변수(시뮬레이션 시간 흐름 속도)를 기반으로 내부 시뮬레이션 시간(`simTime`)을 진행시킵니다. 시간은 10분 단위로 반올림되어 처리됩니다.
*   **경제 모델 연동 (`set_economic_model`)**: 외부에서 생성된 `EconomicModel` 객체를 시뮬레이터에 연결하여 경제 관련 로직을 통합합니다.
*   **시뮬레이션 루프 제어 (암시적)**: `main.py` 또는 `drawer_base.py`의 메인 루프 내에서 `Simulator`의 주요 업데이트 메서드들이 주기적으로 호출됩니다.
    *   `apply_demand_pattern()`: 현재 시간, 날씨, 계절 등을 고려하여 각 건물의 전력 수요를 계산하고, 태양광 발전량을 업데이트합니다. (세부 로직은 `PowerSystem` 또는 `WeatherSystem`으로 위임될 수 있음)
    *   `update_flow(instant=False)`: 전력망 내의 송전선 흐름과 부하를 업데이트합니다. 배터리 상태 업데이트, 실제 송전선 흐름 계산(`compute_line_flows`), 정전 상태 확인(`check_blackouts`)을 포함합니다. `instant=True`일 경우 즉시 흐름을 재계산합니다.
    *   `update_events()`: `EventSystem`을 통해 랜덤 이벤트를 발생시키고 처리합니다.
    *   `update_weather()`: `WeatherSystem`을 통해 날씨 관련 상태(기온, 날씨, 태양광 효율 등)를 업데이트합니다.
    *   `update_battery()`: 각 건물의 배터리 충전 및 방전 상태를 관리합니다.
*   **상태 조회 함수**
    *   `get_current_season()`: 현재 시뮬레이션 시간(`simTime`)을 기준으로 봄, 여름, 가을, 겨울 중 현재 계절을 반환합니다.
    *   `calc_total_flow()`: 도시 전체의 최대 유량(총 공급 가능량)을 계산합니다. 내부적으로 `CityGraph`의 `build_capacity`와 `edmonds_karp` 알고리즘을 사용합니다.
*   **환경 데이터 계산 함수**: 태양 위치(`get_sun_position`), 태양 복사량(`compute_solar_radiation`), 한국 기준 기온(`get_korea_temperature`), 지역 정보(`get_region_info`), 미세먼지 관련 수요 요인(`get_pm_demand_factor`) 등을 계산하는 유틸리티 함수들을 포함하여 `WeatherSystem`과의 상호작용 또는 자체 계산을 수행합니다.

### `city.py` (`CityGraph`, `Building`, `PowerLine` 클래스)

`city.py` 파일은 전력 네트워크의 물리적 구성 요소를 정의하고 관리하는 클래스들을 포함합니다.

#### `Building` 클래스

개별 건물을 나타내는 클래스로, 전력망의 노드 역할을 합니다.

*   **주요 속성**
    *   `idx`: 건물의 고유 식별자.
    *   `name`: 건물의 이름 (기본값: "건물_idx").
    *   `base_supply`: 기본 공급량. 양수면 발전소, 음수면 수요지, 0이면 중립 시설(상가 등)을 의미합니다.
    *   `solar_capacity`: 설치된 태양광 발전 용량.
    *   `current_supply`: 현재 시간, 날씨, 이벤트 등을 고려한 실제 공급/수요량.
    *   `transmitted_power`: 실제로 송전되거나 수신된 전력량.
    *   `x`, `y`: 지도상의 건물 위치 좌표.
    *   `removed`: 건물의 제거(고장) 여부.
    *   `blackout`: 건물의 정전 여부.
    *   `is_prosumer`: 프로슈머(생산자+소비자) 여부.
    *   `building_type`: 건물 유형 (예: "apartment", "office", "hospital" 등). 수요 패턴, 에너지 효율 등에 영향을 줍니다.
    *   `energy_efficiency`: 에너지 효율 (1.0이 기본).
    *   기타 상세 속성: 건설 연도(`year_built`), 면적(`area`), 난방 방식(`heating_source`, `heating_type`, `heating_cop`), 태양광 패널 정보(`panel_tilt`, `panel_azimuth`), 스마트 그리드 연결(`smart_grid_connected`), 배터리 정보(`battery_capacity`, `battery_charge`), 현재 부족 전력량(`shortage`).
*   **주요 메서드**
    *   `get_type_str()`: 건물의 유형을 문자열로 반환합니다 (예: "발전소", "태양광 아파트", "프로슈머(office)"). 다양한 속성을 조합하여 구체적인 건물 유형을 식별합니다.
    *   `get_status_str()`: 건물의 현재 상태(발전량, 수요량, 태양광, 배터리, 정전 여부 등)를 요약된 문자열로 반환합니다. Pygame UI의 툴팁 등에 사용될 수 있습니다.
    *   `get_detailed_info()`: 건물에 대한 상세 정보를 리스트 형태로 반환합니다. UI의 툴팁 표시에 사용됩니다.

#### `PowerLine` 클래스

두 건물(노드)을 연결하는 송전선을 나타내는 클래스로, 전력망의 엣지 역할을 합니다.

*   **주요 속성**
    *   `u`, `v`: 송전선이 연결하는 두 건물의 `idx`.
    *   `capacity`: 송전선의 최대 허용 용량.
    *   `cost`: 송전선 건설/업그레이드 비용 관련 계수.
    *   `flow`: 현재 송전선을 통해 흐르는 전력량 (방향성을 가짐. u->v가 양수).
    *   `removed`: 송전선의 제거(고장) 여부.

#### `CityGraph` 클래스

도시 전체의 전력 네트워크를 그래프 형태로 관리하는 클래스입니다.

*   **주요 속성**
    *   `buildings`: 도시 내 모든 `Building` 객체의 리스트.
    *   `lines`: 도시 내 모든 `PowerLine` 객체의 리스트.
    *   `n`: 도시 내 건물의 총 수.
*   **주요 메서드**
    *   `add_building(base_supply, x, y)`: 새로운 건물을 생성하여 도시에 추가합니다. 건물의 `idx`는 자동으로 할당됩니다.
    *   `add_line(u, v, cap, cost)`: 두 건물 `u`와 `v` 사이에 새로운 송전선을 추가합니다. 건물 인덱스의 유효성을 검사합니다.
    *   `total_demand()`: 현재 도시 전체의 총 유효 수요량(제거되지 않은 수요 건물의 `current_supply` 합계의 절대값)을 계산합니다.
    *   `build_capacity()`: Edmonds-Karp 알고리즘을 사용하여 최대 유량을 계산하기 위한 용량 그래프를 구성합니다. 슈퍼소스(`S_star`)와 슈퍼싱크(`T_star`)를 도입하고, 각 발전소를 슈퍼소스에, 각 수요지를 슈퍼싱크에 연결합니다. 송전선 간의 용량도 설정합니다. 이 메서드는 발전소의 실제 공급 가능량을 연결된 송전선 용량의 합으로 제한하는 로직을 포함합니다.
    *   `restore_all()`: 제거(고장)된 모든 건물과 송전선을 복구 상태로 변경합니다.

## 4. 전력 시스템 모델링

전력 시스템 모델링은 시뮬레이션의 핵심적인 부분으로, 실제 전력망의 동작 방식을 모방하여 전력의 생산, 수요, 흐름, 그리고 관련 문제(정전 등)를 다룹니다.

### `modules/power.py` (`PowerSystem` 클래스)

`PowerSystem` 클래스는 전력 네트워크의 동적인 측면을 관리하고 계산하는 역할을 합니다. `Simulator`에 의해 호출되어 주기적으로 상태를 업데이트합니다.

*   **초기화 (`__init__`)**: 시뮬레이터 인스턴스를 받아 내부 변수들을 초기화합니다. 여기에는 총 공급량(`total_supplied`), 총 수요량(`total_demanded`), 총 흐름량(`total_flow`), 정전 관련 정보(`blackout_count`, `blackout_buildings`), 배터리 관련 통계(`battery_charge_buildings`, `battery_discharge_buildings`, `total_battery_storage`, `total_battery_discharge`) 등이 포함됩니다.
*   **수요 패턴 적용 (`apply_demand_pattern`)**: 각 건물의 현재 전력 수요(`current_supply`)를 계산합니다.
    *   `Simulator`의 시간(`simTime`), `pattern` 데이터(휴일, 계절별/요일별/시간별 패턴), `WeatherSystem`의 환경 정보(온도, 습도, 미세먼지)를 복합적으로 고려합니다.
    *   건물 유형(`building_type` from `data.py`)에 따른 시간대별 사용 패턴(주중/주말, 주간/야간)을 적용합니다.
    *   스마트 그리드 연결 여부에 따라 피크 시간대 수요를 조절합니다.
    *   태양광 발전량을 계산하여 건물의 순수요/공급량에 반영합니다. 이때 태양 위치, 패널 특성, 구름량, 날씨 효율 등을 고려합니다. (`WeatherSystem`의 계산 결과 활용)
    *   프로슈머 건물의 경우, 잉여 전력을 배터리에 저장하는 로직을 포함합니다 (충전 효율 및 최대 충전량 제한 고려).
*   **배터리 관리 (`update_battery`)**: 건물의 배터리 충전 및 방전 로직을 처리합니다.
    *   프로슈머 건물은 자체 로직으로 처리되므로 여기서는 주로 스마트 그리드에 연결된 일반 건물의 배터리를 관리합니다.
    *   오프피크 시간에는 배터리를 충전하고 (충전량 제한, 충전 효율 고려), 피크 시간에는 배터리에서 전력을 방전하여 수요를 충당합니다 (방전 효율 고려).
*   **전력 흐름 계산 및 관리**:
    *   `calc_total_flow()`: `Simulator`의 `power_system` 객체에 저장된 최종 계산된 총 전력 흐름(실제 시스템에 공급된 총량, `max_flow` 또는 `total_flow`)을 반환합니다. 또한 각 건물의 실제 송수신 전력량(`transmitted_power`)을 계산하여 기록합니다.
    *   `compute_line_flows()`: 실제 전력 흐름을 계산하는 핵심 메서드입니다.
        1.  현재 시뮬레이터 내 `city` 객체에서 건물(`Building`)과 송전선(`PowerLine`) 정보를 가져옵니다.
        2.  건물의 `current_supply`를 기준으로 생산자(발전소)와 소비자(수요처)를 식별합니다.
        3.  Edmonds-Karp 알고리즘을 사용하기 위해 그래프를 구성합니다. 슈퍼소스(`S_star`)를 모든 생산자에, 슈퍼싱크(`T_star`)를 모든 소비자에 연결합니다. 이때 생산자의 실제 공급 가능량은 연결된 송전선들의 총 용량 합계와 건물의 `current_supply` 중 작은 값으로 제한됩니다.
        4.  `edmonds_karp(graph, source, sink)`를 호출하여 최대 유량(`max_flow`)과 각 간선에 흐르는 유량(`flows`)을 계산합니다.
        5.  계산된 유량 정보를 각 `PowerLine` 객체의 `flow` 속성에 반영하고, 송전선 사용률(`usage_rate`)도 계산합니다.
        6.  `check_blackouts()`를 호출하여 최종적인 정전 상태 및 전력 통계를 업데이트합니다.
    *   `edmonds_karp(graph, source, sink)`: 주어진 용량 그래프(`graph`), 소스, 싱크를 바탕으로 Edmonds-Karp 알고리즘을 수행하여 최대 유량과 각 간선의 최종 흐름을 반환합니다. 내부적으로 `bfs_find_path`를 반복적으로 호출하여 증가 경로를 찾고 유량을 업데이트합니다.
    *   `bfs_find_path(graph, flows, source, sink)`: BFS(너비 우선 탐색)를 사용하여 `source`에서 `sink`까지의 증가 경로와 해당 경로로 흘릴 수 있는 최소 잔여 용량(bottleneck)을 찾습니다.
*   **정전 분석 (`check_blackouts`)**: 각 건물의 정전 상태를 판단하고 관련 통계를 업데이트합니다.
    *   모든 건물의 정전 상태(`blackout`)와 부족량(`shortage`)을 초기화합니다.
    *   수요 건물에 대해, 해당 건물로 실제 유입되는 전력량(모든 연결된 송전선으로부터의 `flow` 합)을 계산합니다.
    *   실제 공급량이 건물의 수요량의 특정 비율(예: 80%) 미만일 경우 `blackout`으로 처리하고, 부족량(`shortage`)을 기록합니다.
    *   전체 정전 건물 수(`blackout_count`), 총 공급량, 총 수요량, 총 흐름량 등을 업데이트합니다.
*   **주기적 업데이트 (`update_flow`)**: `Simulator`의 메인 루프에서 호출되어 전력 흐름 관련 계산(배터리 업데이트, `compute_line_flows`, `check_blackouts`)을 수행합니다. `instant=True` 옵션을 통해 즉시 계산을 강제할 수 있습니다.

### `algorithms.py` (전력 관련 알고리즘)

`algorithms.py` 파일은 전력 시스템 모델링에 필요한 핵심 알고리즘들을 포함하고 있습니다.

*   **`edmonds_karp(capacity, source, sink)`**: (주: `PowerSystem` 클래스 내부에 유사한 이름의 메서드가 있지만, 이 파일의 `edmonds_karp`는 독립적으로 존재하거나 초기 버전일 수 있습니다. `PowerSystem` 내부의 구현이 더 최신이고 통합된 버전일 가능성이 높습니다.)
    *   주어진 용량 그래프(`capacity`), 소스(`source`), 싱크(`sink`)를 입력받아 최대 유량(`flow_value`)과 잔여 용량 그래프(`residual`)를 반환합니다.
    *   BFS를 사용하여 증가 경로를 찾고, 해당 경로의 병목 용량만큼 유량을 흘려보내는 과정을 반복합니다.
    *   정방향 간선의 잔여 용량은 감소시키고, 역방향 간선의 잔여 용량은 증가시킵니다.
*   **수요 및 공급 요인 계산 함수**:
    *   `compute_demand_factor(sim)`: 시뮬레이터의 현재 시간(`simTime`)과 패턴 데이터(`pattern`)를 기반으로 전반적인 수요 변동 계수를 계산합니다. 일일 패턴, 주간 패턴, 계절 패턴, 휴일 요인 등을 종합적으로 고려합니다. (이 함수는 `PowerSystem.apply_demand_pattern`의 일부 로직과 유사하거나 보조적인 역할을 할 수 있습니다.)
    *   `compute_solar_factor(sim)`: 시뮬레이터의 현재 시간(`simTime`)을 기준으로 태양광 발전량에 영향을 미치는 시간대별 효율 및 계절별 보정 계수를 계산합니다. (이 함수는 `WeatherSystem` 또는 `PowerSystem`의 태양광 계산 로직의 일부와 관련될 수 있습니다.)
    *   `apply_demand_pattern(sim)`: (`PowerSystem`의 메서드와 이름이 동일하나, 이 파일에 독립적으로 존재한다면) 계산된 수요/공급 요인을 각 건물에 적용하여 `current_supply`를 업데이트하는 역할을 할 수 있습니다.
*   **AI 기반 그리드 관리 (예시)**:
    *   `simple_upgrade_ai(sim, budget)`: 주어진 예산(`budget`) 내에서 전력망을 자동으로 개선하는 간단한 AI 로직입니다. 과부하된 송전선을 찾아 용량을 증설하거나, 발전소의 발전량을 늘리는 등의 결정을 내립니다.
    *   `analyze_current_grid_status(simulator)`: 현재 전력망 상태를 분석하여 과부하 송전선, 정전 건물, 전반적인 수급 상황 등 주요 문제점을 식별하고 문자열 리스트로 반환합니다. `drawer_ui.py`의 AI 업그레이드 패널에 분석 정보를 제공하는 데 사용됩니다.
    *   `upgrade_critical_lines(simulator, budget_for_lines)`: `analyze_current_grid_status`와 연계되어, 가장 문제가 심각한(과부하가 심한) 송전선을 찾아 주어진 예산 내에서 용량을 증설하고 실제 소요된 비용을 반환합니다.

## 5. 환경 모델링

환경 모델링은 시뮬레이션의 현실감을 높이고 다양한 외부 요인의 영향을 평가하기 위해 중요합니다. 본 프로젝트에서는 날씨 변화와 돌발 이벤트를 주요 환경 요인으로 다룹니다.

### `modules/weather.py` (`WeatherSystem` 클래스)

`WeatherSystem` 클래스는 시뮬레이션 환경의 날씨 및 관련 환경 조건을 관리하고, 이러한 조건이 전력 시스템에 미치는 영향을 계산합니다. `Simulator` 객체에 포함되어 주기적으로 업데이트됩니다.

*   **초기화 (`__init__`)**: 시뮬레이터 인스턴스를 참조하고, 날씨 관련 기본 상태 변수(현재 날씨, 날씨 지속 시간, 태양광 효율, 현재 기온, 습도, 구름량)와 미세먼지 관련 변수(현재 미세먼지 수준, 지속 시간)를 초기화합니다. 또한, 계절별 및 시간대별 수요에 영향을 주는 기본 배율 값을 설정합니다.
*   **주기적 업데이트 (`update`)**: `Simulator`의 시간 경과(`dt_ms`)에 따라 날씨 및 미세먼지 상태의 지속 시간을 관리하고, 필요시 새로운 상태로 업데이트합니다. 또한 현재 시간과 날씨를 기반으로 기온과 습도를 지속적으로 업데이트합니다.
*   **날씨 상태 관리**:
    *   `update_weather()`: 현재 시뮬레이션 시간(월)과 정의된 확률 테이블(`data.py`의 `region_data` 또는 내부 테이블)을 기반으로 다음 날씨 상태(맑음, 흐림, 비, 눈 등)를 결정합니다. 날씨 변화 시, 해당 날씨의 지속 시간(분 단위)을 랜덤하게 설정하고, 날씨 상태에 따라 구름량(`cloud_factor`)과 기본 태양광 효율(`solar_efficiency`)을 업데이트합니다.
    *   `current_weather`: 현재 날씨 상태를 문자열로 저장합니다 (예: "맑음").
    *   `cloud_factor`: 현재 구름량을 0(맑음)에서 1(완전 흐림) 사이의 값으로 표현합니다.
*   **기온 및 습도 관리**:
    *   `update_temperature()`: `get_korea_temperature()` (또는 유사 함수)를 호출하여 목표 기온을 계산하고, 현재 기온에서 목표 기온으로 점진적으로 변화시킵니다.
    *   `update_humidity()`: 현재 날씨와 계절을 고려하여 목표 습도를 설정하고, 현재 습도에서 목표 습도로 점진적으로 변화시킵니다.
    *   `current_temperature`: 현재 시뮬레이션 환경의 기온을 °C 단위로 저장합니다.
    *   `humidity`: 현재 시뮬레이션 환경의 상대 습도를 % 단위로 저장합니다.
*   **미세먼지 관리**:
    *   `update_pm_levels()`: 미세먼지 등급(예: good, moderate, unhealthy)을 월별 확률 및 현재 날씨의 영향을 고려하여 업데이트합니다. 등급별 지속 시간도 랜덤하게 설정됩니다.
    *   `current_pm_level`: 현재 미세먼지 등급을 문자열로 저장합니다.
*   **태양광 발전량 계산 관련 함수**:
    *   `get_sun_position(current_time, lat, lon)`: 주어진 시간, 위도, 경도를 바탕으로 태양의 고도각과 방위각을 계산합니다.
    *   `compute_solar_radiation(alt_deg, cloud_factor, panel_tilt, panel_azimuth)`: 태양 고도, 구름량, 태양광 패널의 경사각 및 방위각을 고려하여 패널에 도달하는 최종 태양 복사량을 계산하고, 이를 정규화된 발전 효율(0~1)로 반환합니다.
    *   `get_potential_solar_generation_ratio()`: 현재 시간 및 날씨 조건에서 이상적인 패널(남향, 최적 경사각 가정)의 잠재적 태양광 발전 비율을 UI 표시용으로 계산합니다.
*   **수요 영향 계산 함수**:
    *   `get_pm_demand_factor(building)`: 현재 미세먼지 수준(`current_pm_level`)과 건물의 유형별 민감도를 고려하여 전력 수요에 미치는 영향 계수를 반환합니다. (공기청정기 등 사용 증가)
    *   `get_humidity_demand_factor(building, month)`: 현재 습도, 월별 적정 습도, 건물의 습도 민감도를 고려하여 전력 수요에 미치는 영향 계수를 반환합니다. (제습기/가습기 등 사용 변화)
    *   `get_temperature_demand_factor(building)`: 현재 기온, 월별/계절별 적정 기온, 건물의 에너지 효율, 난방 방식(히트펌프 COP 등)을 고려하여 냉난방으로 인한 전력 수요 변화 계수를 반환합니다.
    *   `get_region_info`: `data.py`에 정의된 지역별 데이터(위도, 고도, 월별 평균 기온, 강수 확률, 미세먼지 수준 등)를 조회하는 인터페이스를 제공합니다.

### `modules/event.py` (`EventSystem` 클래스)

`EventSystem` 클래스는 시뮬레이션 도중 예기치 않은 돌발 이벤트를 발생시켜 시스템의 동적인 변화와 안정성 테스트를 가능하게 합니다.

*   **초기화 (`__init__`)**: 시뮬레이터 인스턴스를 참조하고, 이벤트 발생 기본 확률(`event_probability`), 정의된 이벤트 유형들의 리스트(`event_types`), 마지막 이벤트 발생 시간(`last_event_time`), 최소 이벤트 발생 간격(`min_event_interval`), 이벤트 발생 기록(`event_history`) 등을 초기화합니다.
*   **주기적 업데이트 (`update_events`)**: `Simulator`에 의해 주기적으로 호출되어 다음을 수행합니다.
    1.  마지막 이벤트 발생 시간으로부터 최소 발생 간격이 경과했는지 확인합니다.
    2.  기본 확률(`event_probability`)에 따라 새로운 이벤트를 발생시킬지 결정합니다.
    3.  이벤트 발생 시, `random_event()`를 호출합니다.
*   **랜덤 이벤트 발생 (`random_event`)**: `event_types` 리스트에 등록된 이벤트 함수 중 하나를 무작위로 선택하여 실행합니다. 이벤트 발생에 성공하면 시뮬레이터의 `event_count`를 증가시키고, 마지막 이벤트 시간을 기록하며, 이벤트 정보를 `event_history`에 추가합니다. 또한, 이벤트 발생 후 즉시 전력 흐름을 업데이트하도록 `simulator.update_flow(instant=True)`를 호출합니다.
*   **이벤트 유형 (예시 함수)**: 각 이벤트 함수는 특정 유형의 사건을 시뮬레이션합니다.
    *   `random_line_trip()`: 활성화된 송전선 중 하나를 무작위로 선택하여 일시적으로 제거(`removed = True`)합니다.
    *   `random_line_half()`: 활성화된 송전선 중 하나의 용량(`capacity`)을 절반으로 감소시킵니다.
    *   `random_bldg_remove()`: 활성화된 건물 중 하나를 무작위로 선택하여 제거합니다.
    *   `random_gen_off()`: 운영 중인 발전소 중 하나의 현재 발전량(`current_supply`)을 일정 비율(20~50%) 감소시킵니다.
    *   `random_demand_spike()`: 운영 중인 소비 건물 중 하나의 현재 수요량(`current_supply`)을 일정 비율(30~80%) 증가시킵니다.
    *   `random_solar_boost()`: 날씨가 "맑음"일 때, 태양광 설비가 있는 모든 건물의 발전량을 일시적으로 증가시킵니다.
    *   `random_battery_fault()`: 배터리가 설치된 건물 중 하나의 배터리 충전량을 일정 비율(50~100%) 감소시킵니다.
*   **이벤트 기록 조회 (`get_event_history`)**: 발생했던 이벤트들의 기록을 반환합니다.

## 6. 경제 모델링

경제 모델링은 에너지 가격 결정, 투자 수익 분석 등 경제적 측면을 시뮬레이션에 통합하는 데 중요합니다.

### `modules/economics.py`

`EconomicModel` 클래스는 `Simulator`와 연동되어 전력 시스템의 경제적 측면을 시뮬레이션합니다.

*   **초기화 (`__init__`)**: 시뮬레이터 인스턴스를 참조하고, 경제 관련 변수들(예: 현재 전기 가격, 가격 변동 내역, 거래 내역, 투자 수익률 등)을 초기화합니다.
*   **에너지 가격 결정 (`update_energy_prices`, `calculate_electricity_price`)**: 주기적으로 또는 특정 조건 발생 시 전기 가격을 업데이트합니다.
    *   **공급 및 수요 요인**: 현재 전력망의 총 공급량과 총 수요량 간의 균형을 기반으로 가격을 조정합니다. 수요가 공급을 초과하면 가격이 상승하고, 공급이 수요를 초과하면 가격이 하락하는 기본적인 시장 원리를 따릅니다. (`calculate_supply_demand_factor`)
    *   **날씨 요인**: 극한의 기온(혹서, 혹한)이나 특정 날씨 조건(예: 장기간 비로 인한 태양광 발전량 감소)이 가격에 영향을 미칠 수 있습니다. (`calculate_weather_price_factor`)
    *   **연료 비용 및 탄소세**: 발전소의 연료 비용 변동이나 탄소 배출 관련 세금(`calculate_carbon_tax`)이 발전 단가에 영향을 주어 최종 전기 가격에 반영될 수 있습니다. (`calculate_generation_cost`)
*   **투자 결정 및 분석 (`make_investment`, `calculate_roi`)**: 사용자의 투자 결정(예: 신규 발전소 건설, 송전선 증설, 에너지 저장 장치(ESS) 도입)을 시뮬레이션하고 그 경제적 효과를 분석합니다.
    *   `make_investment(investment_type, params)`: 특정 유형의 투자(예: '발전소', '송전선')와 관련 파라미터(용량, 비용 등)를 받아 투자를 실행하고, 시뮬레이터의 예산(`budget`)에서 비용을 차감합니다.
    *   `calculate_roi(investment_type, params)`: 특정 투자에 대한 예상 투자수익률(ROI)을 계산하여 사용자에게 정보를 제공할 수 있습니다. 이는 투자 결정의 근거로 활용됩니다.
*   **전력 판매 및 수익 계산 (`sell_electricity`)**: 발전소나 프로슈머가 생산한 전력을 판매하고 수익을 얻는 과정을 모델링합니다. 판매 가격은 현재 `EconomicModel`에 의해 결정된 전기 가격을 따릅니다. 건물 유형에 따라 다른 판매 조건이나 계약이 적용될 수 있습니다.
*   **경제 통계 조회 (`get_economic_stats`, `get_price_history`, `get_transactions`)**:
    *   `get_economic_stats()`: 현재 시뮬레이션의 주요 경제 지표(총 수익, 총 지출, 순이익, 현재 전기 가격, ROI 등)를 요약하여 반환합니다. 이 정보는 `SimulationAnalytics`를 통해 보고서에 포함되거나 UI에 표시됩니다.
    *   `get_price_history()`: 시간 경과에 따른 전기 가격 변동 내역을 반환합니다.
    *   `get_transactions()`: 발생한 주요 경제 거래(투자, 전력 판매 수익 등) 내역을 반환합니다.

이 `EconomicModel`은 `Simulator`의 메인 루프에서 `update_energy_prices`와 같은 메서드가 주기적으로 호출되어 경제 상황을 업데이트하고, 사용자의 투자 행동이나 시스템의 상태 변화에 따라 동적으로 반응하도록 설계될 수 있습니다. `main.py`에서 `--analyze` 옵션과 함께 실행될 경우, `SimulationAnalytics`를 통해 경제적 결과도 분석에 포함될 수 있습니다.

## 7. 데이터 관리

시뮬레이션의 현실성과 다양성은 잘 구성된 기초 데이터와 시나리오에 크게 의존합니다. 본 프로젝트에서는 `data.py`와 `scenarios.json` 파일이 이러한 역할을 담당합니다.

### `data.py`

`data.py` 파일은 시뮬레이션 전반에서 사용되는 비교적 정적인 데이터들을 파이썬 딕셔너리 및 리스트 형태로 정의하고 있습니다. 이 데이터들은 주로 환경 모델링(날씨, 기온), 수요 패턴 계산, 건물 특성 부여 등에 활용됩니다.

*   **주요 포함 데이터**
    *   **`region_data`**: 지역별 상세 데이터를 포함하는 딕셔너리입니다. 각 지역(예: "Seoul", "Incheon")을 키로 가지며, 하위에는 다음 정보들이 포함될 수 있습니다.
        *   `lat`, `lon`: 해당 지역의 위도, 경도 (태양 위치 계산 등에 사용).
        *   `altitude`: 해발고도.
        *   `monthly_avg_temp`: 월별 평균 기온 리스트.
        *   `monthly_daily_range`: 월별 일교차 리스트.
        *   `monthly_rain_prob`: 월별 강수 확률 리스트.
        *   `pm_levels`: 미세먼지 등급(good, moderate, unhealthy 등)별 발생 확률.
        *   (추가적으로 `simulator.py`의 `get_region_info`에서 내부적으로 생성하는 `weather_table`, `humidity` 데이터 등도 이와 유사한 형태로 관리될 수 있습니다.)
    *   **`building_type_factors`**: 건물 유형별 특성 계수를 정의하는 딕셔너리입니다. 각 건물 유형(예: "apartment", "office")을 키로 가지며, 하위에는 다음 정보들이 포함됩니다.
        *   `heat_factor`, `cool_factor`: 난방 및 냉방 부하 관련 계수.
        *   `humidity_control_factor`: 습도 조절 관련 부하 계수.
        *   `pm_sensitive`: 미세먼지 민감도 (공기청정기 등 사용 증가에 영향).
        *   `weekday_day_factor`, `weekday_night_factor`, `weekend_day_factor`, `weekend_night_factor`: 주중/주말 및 주간/야간에 따른 전력 사용 패턴 배율.
        *   `lighting_factor`: 조명 부하 관련 계수.
    *   **기타 패턴 데이터**: `simulator.py` 내부에 직접 정의된 `season_demand_multiplier`, `time_demand_multiplier` 등과 같이, 시나리오 파일(`scenarios.json`)의 `"pattern"` 섹션에 포함되어 로드될 수 있는 기본 수요 패턴 데이터(일별, 주별, 계절별, 휴일 등)도 `data.py`에서 관리될 수 있습니다.

이러한 데이터는 시뮬레이션의 초기 설정이나 특정 조건 계산 시 참조되어, 보다 현실적이고 다양한 상황을 모의실험할 수 있도록 지원합니다.

### `scenarios.json`

`scenarios.json` 파일은 사용자가 다양한 실험 환경을 구성하고 저장할 수 있도록 시뮬레이션 시나리오를 JSON 형식으로 정의합니다. `main.py`에서 이 파일을 읽어 `Simulator`에 전달하고, `Simulator`는 선택된 시나리오에 따라 내부 상태를 초기화합니다.

*   **파일 구조**: 최상위에는 `"scenarios"`라는 키가 있으며, 이 키의 값은 시나리오 객체들의 리스트입니다. 각 시나리오 객체는 다음과 같은 주요 정보들을 포함할 수 있습니다.
    *   `"name"`: 시나리오의 고유한 이름 (예: "기본 서울 전력망").
    *   `"desc"`: 시나리오에 대한 간략한 설명.
    *   `"region"` (선택적): 시뮬레이션 대상 지역 (예: "Seoul"). `data.py`의 `region_data`와 연동됩니다.
    *   `"pattern"` (선택적): 해당 시나리오에 적용될 특정 수요 패턴 데이터. 만약 제공되지 않으면 `Simulator`의 기본 패턴이나 `data.py`의 기본값을 사용할 수 있습니다. 포함될 수 있는 하위 키는 다음과 같습니다.
        *   `"daily_pattern"`: 시간대별(0-23시) 수요 배율 리스트.
        *   `"weekly_pattern"`: 요일별(월-일) 수요 배율 리스트.
        *   `"seasonal_pattern"`: 월별(1-12월) 수요 배율 리스트.
        *   `"holiday_list"`: 휴일 목록 (각각 `month`와 `day` 포함).
        *   `"holiday_factor"`: 휴일일 경우 적용될 수요 배율.
    *   `"buildings"`: 해당 시나리오의 건물 구성을 정의하는 객체 리스트. 각 건물 객체는 다음 정보를 포함합니다.
        *   `"idx"` (일반적으로 로딩 시 자동 부여되지만, 명시 가능).
        *   `"name"` (선택적): 건물의 이름.
        *   `"base_supply"`: 기본 공급/수요량.
        *   `"x"`, `"y"`: 지도상 위치.
        *   `"removed"` (선택적, 기본값 `false`): 초기 제거(고장) 상태.
        *   `"solar_capacity"` (선택적, 기본값 `0.0`): 태양광 설치 용량.
        *   `"is_prosumer"` (선택적, 기본값 `false`): 프로슈머 여부.
        *   `"building_type"` (선택적, 기본값 `"apartment"`): 건물 유형.
        *   `"battery_capacity"`, `"battery_charge"` (선택적): 배터리 용량 및 초기 충전량.
        *   기타 `Building` 클래스의 속성들 (예: `panel_tilt`, `smart_grid_connected` 등).
    *   `"lines"`: 해당 시나리오의 송전선 구성을 정의하는 객체 리스트. 각 송전선 객체는 다음 정보를 포함합니다.
        *   `"u"`, `"v"`: 연결되는 두 건물의 `idx`.
        *   `"capacity"`: 송전선 용량.
        *   `"cost"` (선택적, 기본값 `1.0`): 건설/업그레이드 비용 계수.
        *   `"removed"` (선택적, 기본값 `false`): 초기 제거(고장) 상태.
    *   `"budget"` (선택적, 기본값 `30.0`): 초기 예산.
    *   `"money"` (선택적, 기본값 `50.0`): 초기 자금.
*   **활용**: `main.py`에서 `--scenario` 명령행 인자를 통해 특정 시나리오를 선택하여 실행할 수 있습니다. 웹 인터페이스에서도 시나리오 목록을 제공하고 사용자가 선택하여 로드할 수 있는 기능을 제공합니다 (`/api/scenarios`, `/api/load_scenario`).

이러한 데이터 관리 방식을 통해 시뮬레이션의 유연성과 확장성을 높이고, 사용자가 다양한 조건 하에서의 전력망 동작을 쉽게 실험하고 분석할 수 있도록 합니다.

## 8. 사용자 인터페이스

사용자 인터페이스는 시뮬레이션을 시각적으로 확인하고 직접 제어할 수 있는 Pygame 기반의 그래픽 인터페이스와 Flask 기반의 웹 인터페이스를 제공합니다.

### Pygame 기반 UI

Pygame을 사용하여 시뮬레이션을 시각화하고 사용자와 상호작용하는 인터페이스입니다.

### Web 기반 UI (Flask)

Flask와 SocketIO를 사용하여 웹 브라우저를 통해 시뮬레이션 상태를 원격으로 모니터링하고 제어하는 인터페이스입니다.

## 9. 시뮬레이션 분석

시뮬레이션의 가치는 실행 결과를 분석하여 의미 있는 통찰력을 얻는 데 있습니다. 본 프로젝트는 `SimulationAnalytics` 클래스를 통해 시뮬레이션 데이터를 수집하고, 다양한 지표를 분석하며, 사용자 친화적인 형태로 결과를 제공하는 기능을 갖추고 있습니다.

### `modules/analytics.py` (`SimulationAnalytics` 클래스)

`SimulationAnalytics` 클래스는 `Simulator` 인스턴스로부터 데이터를 받아 시뮬레이션 과정과 결과를 분석하는 역할을 합니다. `main.py`에서 `--analyze` 옵션이 주어졌을 때 주로 활용됩니다.

*   **초기화 (`__init__`)**: `Simulator` 객체를 인자로 받아 내부적으로 연결하고, 분석 데이터 저장을 위한 리스트(`history`) 및 기타 분석 관련 변수들을 초기화합니다.
*   **주기적 데이터 수집 (`collect_data_point`, `update`)**: `Simulator`의 메인 루프와 연동되어 (또는 특정 간격으로) 현재 시뮬레이션 상태의 주요 지표들을 수집하여 `history` 리스트에 기록합니다.
    *   **수집 지표 (예시)**:
        *   시뮬레이션 시간 (`simTime`)
        *   총 전력 수요 (`total_demand`)
        *   총 전력 공급 (`total_supply`, 실제 발전량)
        *   총 전력 흐름 (`total_flow`)
        *   정전 발생 건수 (`blackout_count`)
        *   정전된 건물의 총 수요 (피해 규모)
        *   예비 전력량 (총 공급 가능량 - 현재 수요)
        *   송전선 평균/최대 사용률
        *   주요 발전원별 발전량 (태양광, 일반 발전소 등)
        *   배터리 총 저장량 및 충/방전량
        *   경제 관련 지표 (현재 전기 가격, 누적 수익/비용 등 - `EconomicModel` 연동 시)
        *   이벤트 발생 횟수 및 유형
        *   현재 날씨, 기온, 미세먼지 수준
    *   `update()`: `Simulator`의 업데이트 주기에 맞춰 `collect_data_point()`를 호출할 수 있습니다.
*   **보고서 생성 (`generate_report`)**: 수집된 `history` 데이터를 바탕으로 시뮬레이션 전체 기간 또는 특정 기간에 대한 요약 보고서를 생성합니다. 이 보고서는 딕셔너리 형태로 주요 분석 결과를 포함합니다.
    *   **분석 항목 (예시)**:
        *   시뮬레이션 총 기간 및 실제 경과 시간
        *   평균/최대/최소 전력 수요 및 공급
        *   총 정전 시간 및 정전 횟수, 평균 정전 지속 시간
        *   에너지 손실량 (공급량 - 수요 충족량)
        *   주요 송전선의 병목 현상 분석 (평균/최대 부하율, 과부하 시간)
        *   신재생 에너지 발전 비율 및 기여도
        *   배터리 활용 효율 분석
        *   경제성 분석 (총 운영 비용, 수익, 투자 대비 효과 등)
        *   가장 빈번하게 발생한 이벤트 및 그 영향
        *   특정 날씨 조건(혹서기, 혹한기, 장마철 등)에서의 시스템 응답 특성
    *   이 보고서는 `main.py`에서 콘솔에 출력되거나, 웹 UI의 `/api/report` 엔드포인트를 통해 JSON 형태로 제공될 수 있습니다.
*   **LLM 기반 분석 (`get_llm_analysis`)**: (선택적 고급 기능) 생성된 정량적 보고서나 시뮬레이션 로그를 바탕으로 대규모 언어 모델(LLM)을 활용하여 자연어 형태의 질적 분석 및 해석을 제공할 수 있습니다.
    *   예: "시뮬레이션 결과, 하계 피크 시간대에 B 구역의 송전선 용량 부족으로 인해 빈번한 정전이 발생했습니다. 해당 지역의 송전선 증설 또는 ESS 설치를 고려해볼 수 있습니다."
    *   이를 위해서는 LLM API 연동 및 적절한 프롬프트 엔지니어링이 필요합니다.
*   **데이터 저장 및 시각화 (`save_data`, `plot_metrics`)**:
    *   `save_data(filename)`: 수집된 시계열 데이터(`history`)를 CSV 또는 JSON 파일 형태로 저장하여 외부 도구(Excel, Python Pandas 등)에서 추가 분석이 가능하도록 합니다.
    *   `plot_metrics(save_path=None)`: Matplotlib 등의 라이브러리를 사용하여 주요 지표(시간에 따른 수요/공급 변화, 정전 추이, 전기 가격 변동 등)를 그래프로 시각화하고, 이미지 파일로 저장하거나 화면에 직접 표시할 수 있습니다.

`SimulationAnalytics`는 단순히 데이터를 기록하는 것을 넘어, 시뮬레이션 결과를 바탕으로 시스템의 약점을 진단하고 개선 방향을 제시하는 데 중요한 역할을 수행합니다. 사용자는 이 분석 결과를 통해 더 효율적이고 안정적인 전력망 운영 전략을 수립하는 데 도움을 받을 수 있습니다.

## 10. 결론 및 향후 개선 방향

본 전력 네트워크 시뮬레이터 프로젝트는 복잡한 전력 시스템의 동작을 다양한 측면에서 모의실험하고 분석할 수 있는 강력한 도구입니다. 상세한 물리적 네트워크 모델링(`city.py`), 동적인 전력 흐름 계산(`modules/power.py`, `algorithms.py`), 현실적인 환경 변화 요인(날씨, 이벤트 - `modules/weather.py`, `modules/event.py`), 그리고 경제적 측면(`modules/economics.py`)까지 고려하여 심도 있는 분석이 가능하도록 설계되었습니다.\n\n시뮬레이션의 핵심인 `Simulator` 클래스는 이러한 다양한 모듈들을 통합적으로 관리하며 시간의 흐름에 따른 시스템의 변화를 조율합니다. 사용자는 Pygame 기반의 인터랙티브한 로컬 GUI 또는 Flask 기반의 웹 UI를 통해 시뮬레이션 과정을 관찰하고 제어할 수 있으며, `scenarios.json` 파일을 통해 다양한 초기 조건과 네트워크 구성을 손쉽게 설정하여 실험할 수 있습니다.\n\n`SimulationAnalytics` 모듈은 시뮬레이션 결과로부터 주요 지표를 추출하고 분석하여 정량적인 데이터를 제공하며, 이는 전력망의 성능 평가, 취약점 분석, 그리고 개선 전략 수립에 유용하게 활용될 수 있습니다. 이 프로젝트는 교육적 목적뿐만 아니라, 실제 전력 시스템 계획 및 운영에 대한 연구 및 의사결정 지원 도구로서의 잠재력을 가지고 있습니다.\n\n### 향후 개선 방향\n\n본 프로젝트는 지속적인 개선과 기능 확장을 통해 더욱 발전할 수 있습니다. 다음은 몇 가지 잠재적인 향후 개선 방향입니다.\n\n1.  **모델 정교화**:
    *   **AC/DC 전력 흐름**: 현재의 최대 유량 기반 모델에서 더 나아가, 실제 전력 시스템에서 사용되는 AC 또는 DC 전력 흐름 계산 모델(예: Newton-Raphson, Gauss-Seidel 방법)을 도입하여 전압, 위상각, 무효 전력 등을 고려한 정밀 분석 기능을 추가합니다.
    *   **보호 계전 시스템**: 과부하, 단락 등의 고장 상황 발생 시 자동으로 해당 구간을 차단하고 시스템을 보호하는 보호 계전 시스템의 동작을 모델링합니다.
    *   **에너지 저장 시스템(ESS) 상세 모델링**: 배터리 외 다양한 유형의 ESS(양수 발전, 플라이휠 등) 모델을 추가하고, 충방전 전략, 수명 예측, 그리드 서비스(주파수 조정 등) 제공 기능 등을 구체화합니다.
    *   **분산 전원(DER) 상세 모델링**: 소규모 태양광, 풍력, 연료전지 등 분산 전원의 특성과 그리드 연동 방식을 더욱 상세하게 모델링합니다.
2.  **AI 및 최적화 기능 강화**:
    *   **강화학습 기반 운영 최적화**: 전력망 운영(발전 스케줄링, ESS 충방전, 수요 반응 등)을 강화학습 에이전트를 통해 최적화하는 기능을 개발합니다.
    *   **AI 기반 예측 기능**: 머신러닝 모델을 활용하여 단기/장기 부하 예측, 신재생에너지 발전량 예측, 설비 고장 예측 등의 기능을 통합합니다.
    *   **네트워크 확장 계획 최적화**: 유전 알고리즘, 모의 담금질 등의 최적화 기법을 사용하여 비용, 안정성, 환경 영향 등을 고려한 최적의 네트워크 확장 계획(신규 발전소/송전선 입지 및 용량 결정)을 수립하는 기능을 추가합니다.
3.  **사용자 인터페이스 및 경험(UX) 개선**:
    *   **웹 UI 기능 확장**: 웹 UI에서 Pygame UI 수준의 상세한 네트워크 편집 및 제어 기능을 제공하고, 시뮬레이션 결과 시각화 기능을 강화합니다 (예: 인터랙티브 차트, GIS 연동 맵핑).
    *   **3D 시각화**: 도시 및 전력망을 3D로 시각화하여 더욱 직관적인 이해를 돕습니다.
    *   **시나리오 편집기**: GUI 환경에서 사용자가 직접 건물, 송전선, 이벤트 등을 손쉽게 배치하고 수정하여 시나리오를 생성/편집할 수 있는 도구를 제공합니다.
4.  **확장성 및 연동성 강화**:
    *   **API 표준화 및 외부 연동**: 다른 시뮬레이션 도구나 실제 전력 시스템 데이터(SCADA 등)와 연동할 수 있도록 표준화된 API를 제공합니다.
    *   **클라우드 기반 실행 및 대규모 시뮬레이션 지원**: 대규모 네트워크나 장기간 시뮬레이션을 위해 클라우드 환경에서의 실행을 지원하고 병렬 처리 기능을 도입합니다.
    *   **오픈소스 커뮤니티 활성화**: 프로젝트를 오픈소스로 공개하고 커뮤니티를 통해 다양한 기여를 유도하여 지속적인 발전을 꾀합니다.
5.  **교육 및 연구 활용성 증대**:
    *   **튜토리얼 및 예제 시나리오 다양화**: 초보 사용자도 쉽게 프로젝트를 이해하고 활용할 수 있도록 다양한 튜토리얼과 교육용 예제 시나리오를 제공합니다.
    *   **연구 플랫폼으로서의 기능 강화**: 연구자들이 자신들의 알고리즘이나 모델을 쉽게 테스트하고 비교 분석할 수 있는 플러그인 아키텍처를 도입합니다.

이러한 개선 방향을 통해 본 전력 네트워크 시뮬레이터는 더욱 정교하고 실용적인 도구로 발전하여, 미래 전력 시스템 연구와 교육, 그리고 산업 현장에서의 의사결정에 기여할 수 있을 것으로 기대됩니다.\n\n---
